<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rašytojo biografija</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; background: #fafafa; color: #333; }
    header { background: #3b3b98; color: white; padding: 1rem; text-align: center; }
    main { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    .writer-header { display: flex; flex-wrap: wrap; align-items: center; gap: 2rem; }
    .writer-header img { border-radius: 12px; width: 220px; height: 280px; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    .writer-info h1 { margin: 0; font-size: 2rem; color: #2d2d2d; }
    .writer-info p { margin: 0.4rem 0; }
    .bio { margin-top: 2rem; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem; }
    .gallery img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; transition: transform 0.3s; }
    .gallery img:hover { transform: scale(1.05); }
    #map { height: 400px; margin-top: 2rem; border-radius: 12px; }
    footer { text-align: center; padding: 1rem; background: #3b3b98; color: white; margin-top: 3rem; }
  </style>
</head>
<body>
  <header><h1>Rašytojo biografija</h1></header>

  <main id="writer-content">
    <p>Kraunama...</p>
  </main>

  <footer>© 2025 Rašytojų pėdsakais projektas</footer>

  <script>
    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const [headerLine, ...lines] = text.trim().split('\n');
      const headers = headerLine.split(',');
      return lines.map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
        return obj;
      });
    }

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    async function init() {
      const id = getParam('id');
      if (!id) {
        document.getElementById('writer-content').innerHTML = "<p>Nerastas rašytojas.</p>";
        return;
      }

      const [writers, photos, places] = await Promise.all([
        loadCSV('data/rasytojai.csv'),
        loadCSV('data/nuotraukos.csv'),
        loadCSV('data/vietos.csv')
      ]);

      const writer = writers.find(w => w.id === id);
      if (!writer) {
        document.getElementById('writer-content').innerHTML = "<p>Toks rašytojas nerastas.</p>";
        return;
      }

      const writerPhotos = photos.filter(p => p.writer_id === id);
      const writerPlaces = places.filter(p => p.writer_id === id);

      document.getElementById('writer-content').innerHTML = `
        <div class="writer-header">
          <img src="images/${writer.photo}" alt="${writer.name}">
          <div class="writer-info">
            <h1>${writer.name}</h1>
            <p><strong>Gimimo data:</strong> ${writer.birth}</p>
            <p><strong>Mirties data:</strong> ${writer.death}</p>
            <p><strong>Regionas:</strong> ${writer.region}</p>
            <p><strong>Žanras:</strong> ${writer.genre}</p>
          </div>
        </div>

        <section class="bio">
          <h2>Trumpa biografija</h2>
          <p>${writer.biography}</p>
        </section>

        <section class="gallery">
          ${writerPhotos.map(p => `<img src="images/${p.filename}" alt="${writer.name}">`).join('')}
        </section>

        <section>
          <h2>Gyvenimo ir kūrybos vietos</h2>
          <div id="map"></div>
        </section>
      `;

      // Interaktyvus žemėlapis
      const map = L.map('map').setView([55.1694, 23.8813], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap'
      }).addTo(map);

      writerPlaces.forEach(p => {
        if (p.lat && p.lng) {
          L.marker([+p.lat, +p.lng])
            .addTo(map)
            .bindPopup(`<b>${p.name}</b><br>${p.description || ''}`);
        }
      });
    }

    init();
  </script>
</body>
</html>
